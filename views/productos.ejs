<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f4f6f8; }
    .post-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fff;
      overflow: hidden;
      transition: transform 0.2s;
    }
    .post-card:hover { transform: translateY(-5px); }
    .post-card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    .post-card .card-body {
      padding: 1rem;
    }
    .post-card .user-info {
      font-size: 0.9rem;
      font-weight: bold;
    }
    .post-card .price {
      color: #28a745;
      font-weight: bold;
    }
    #productos-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">Mi Tienda</a>
      <div class="d-flex">
        <a href="/" class="btn btn-outline-light me-2">Inicio</a>
        <a href="/api-docs" target="_blank" class="btn btn-primary">API Docs</a>
      </div>
    </div>
  </nav>

  <!-- Contenido -->
  <main class="container my-4">
    <div class="text-center mb-4">
      <h1 class="fw-bold">Nuestros Productos</h1>
      <p class="text-muted">Explora nuestra lista de productos disponibles</p>
    </div>

    <!-- Contenedor de productos -->
    <div id="productos-container">
      <!-- Productos se cargar√°n din√°micamente aqu√≠ -->
    </div>

    <!-- Loader -->
    <div id="loader" class="text-center my-4 d-none">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Cargando productos...</p>
    </div>

    <!-- Mensaje cuando no hay productos -->
    <div id="no-productos" class="alert alert-warning text-center d-none">
      üö´ No hay productos disponibles en este momento.
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script productos -->
  <script>
  const productosContainer = document.getElementById("productos-container");
  const loader = document.getElementById("loader");
  const noProductos = document.getElementById("no-productos");

  async function loadProductos() {
    loader.classList.remove("d-none");
    productosContainer.innerHTML = "";
    noProductos.classList.add("d-none");

    try {
      // ‚úÖ No se env√≠a token porque el endpoint es p√∫blico
      const res = await fetch("/api/productos");
      const json = await res.json();
      loader.classList.add("d-none");

      if (!json.state) {
        noProductos.textContent = json.error || "Error al cargar productos";
        noProductos.classList.remove("d-none");
        return;
      }

      if (json.productos.length === 0) {
        noProductos.classList.remove("d-none");
        return;
      }

      json.productos.forEach(p => {
        const card = document.createElement("div");
        card.classList.add("post-card", "shadow-sm");

        card.innerHTML = `
  <img src="${p.imagen || 'https://via.placeholder.com/300'}" alt="${p.titulo}">
  <div class="card-body">
    <h5 class="card-title">${p.titulo}</h5>
    <p class="card-text">${p.descripcion}</p>
    <p class="price">Precio: $${p.precio}</p>
    <hr>
    <p class="user-info">Vendedor: ${p.usuarioId?.nombre || 'Desconocido'}</p>
    <p class="user-info">Correo: ${p.usuarioId?.correo || 'N/A'}</p>
    <p class="user-info">Tel√©fono: ${p.usuarioId?.telefono || 'N/A'}</p>
    <a href="/producto/${p._id}" class="btn btn-primary mt-2">Ver m√°s</a>
  </div>
`;

        productosContainer.appendChild(card);
      });

    } catch (err) {
      loader.classList.add("d-none");
      noProductos.textContent = "‚ö†Ô∏è Error de conexi√≥n con el servidor.";
      noProductos.classList.remove("d-none");
    }
  }

  loadProductos();
</script>


</body>
</html>
